\documentclass[a4j,titlepage]{jarticle}
\usepackage[dvipdfmx]{graphicx}
\usepackage{ascmac}
\usepackage{url}
\usepackage{multirow}


\title{呑兵衛土佐巡\\
内部設計書\\
第1版}
\author{株式会社Spirytus}
\date{\today}

\begin{document}
\maketitle
\tableofcontents

\clearpage

\section{概要}
\subsection{動作環境}
動作環境は、以下のブラウザを推奨しています。
\begin{itemize}
\item Chrome 47.0
\item Safari 5.1.10
\item Opera 33.0
\item IE 11.0
\item Fireforx 42.0
\end{itemize}

\subsection{開発環境}
開発環境は、以下のOSを使用しています。
\begin{itemize}
\item centOS 6.5
\item Mac OSX
\end{itemize}

\subsection{使用言語}
本システムでは、以下の言語を使用し開発しています。
\begin{itemize}
\item HTML5
\item CSS3
\item JavaScript
\item Ruby 2.2.3
\end{itemize}

\subsection{使用フレームワーク}
本システムでは、以下のフレームワークを使用しています。
\begin{itemize}
\item Bootstrap 3.3.6
\item jQuery 2.1.4
\item Ruby on Rails 4.2.4
\end{itemize}


\section{コーディング規約}
​
\subsection{コーディング規約}
本システムを作成する際には、以下の規約に則ってコーディングを行います。
\begin{description}
\item[HTML、CSS]\mbox{}\\
HTML及びCSSは、「Google HTML/CSS Style Guide」に従ってコーディングを行います。\\
(参考:https://google.github.io/styleguide/htmlcssguide.xml)
​
\item[JavaScript]\mbox{}\\
JavaScriptは、「Google JavaScript Style Guide」に従ってコーディングを行います。\\
(参考:https://google.github.io/styleguide/javascriptguide.xml)
​
\item[Ruby]\mbox{}\\
Rubyは、「ruby-style-guide」に従ってコーディングを行います。\\
(参考:https://github.com/bbatsov/ruby-style-guide)
​
\item[Ruby on Rails]\mbox{}\\
Ruby on Railsは、コーディング解析ツール「RuboCop」を使用してコードのチェックを行います。
(参考:https://github.com/bbatsov/rubocop)
\end{description}

\subsection{モジュール一覧}
本システムを構成するモジュールは、以下の通りです。
\begin{enumerate}
\item [SEARCH] : データベースから検索条件にあった情報を取得するモジュール
\item [REGISTER] : データベースに情報を登録するモジュール
\item [LOGIN] : ログインする処理を行なうモジュール
\item [CHECK] : データベースから情報を取得する際、データが正しいか確認するモジュール
\item [DIRECT MAIL] : メールを送信するモジュール
\item [DELETE] : データベースに登録している情報を削除するモジュール
\item [ALGORITHM] : 計算するモジュール
\item [MULTI MODULE] : 複数のモジュールを組み合わせるモジュール
\item [ERROR] : エラーが起こったときに行なうモジュール
\end{enumerate}

\clearpage

\subsection{モジュール定義}
各言語において実現したい機能、および共通の機能は以下の通りです。
\subsubsection{CSS}
\begin{description}
\item[ロールオーバー]~\\
別画面へ遷移するボタンや画像にマウスポインタを当てたときに、色や画像が切り替わる機能を適用します。
この機能を用いることで、別画面に遷移するボタンや画像を、ユーザが簡単に判断することができます。
CSSより、background-imageの切り替えを行うことで、ロールオーバーを実現します。
\end{description}

\subsubsection{JavaScript}
\begin{description}
\item [プルダウン]~\\
ホーム画面の各タブ内において、メニューの階層をまとめて表示することが可能となります。
この機能を用いることで、ユーザが目的のページまで容易に遷移することができます。
JQueryよりhover関数を呼び出し、slideDown()とslideUp()を呼び出すことでプルダウンを実現します。

\item [画像の自動切り替え（スライド）]~\\
画面内で画像を表示させる際、画像の切り替えにスライド効果を適用します。
この機能を用いることで、いくつかの情報（画像）を自動で出力することができるため、
ユーザによりわかりやすく情報を提供することができます。
JQueryよりslider関数を呼び出すことで、画像の自動切り替え（スライド）を実現します。

\item[画像の自動切り替え（フェード）]~\\
上記と同様で、画像の切り替えにフェード効果を適用します。
JQueryよりsetInterval関数を呼び出して、
fadeOutとfadeInを呼び出すことで画像の自動切り替え（フェード）を実現します。

\item[星での評価]~\\
ユーザが店舗へのレビューをする際、店舗の評価を星の数によって決めることができます。
この機能を用いることで、ユーザが簡単に店舗の評価を決めることができます。
JQueryよりraty関数を呼び出すことで、星での評価を実現します。

\item[タブ切り替え]~\\
検索画面において、別画面に遷移することなく検索項目を切り替えることができます。
この機能を用いることで、検索項目を切り替える際にページを読み込む時間がなくなり、ユーザが検索したい項目をより早く選択することができます。
JQueryより、removeClass関数とaddClass関数を呼び出すことで、タブ切り替えを実現します。

\item[説明画面出力(lightbox)]~\\
詳しい説明を画像と説明文で説明する際、表示対象が出てきます。
同じHTML上に表示したいものを隠しているので、使い過ぎは修正や更新時に混乱を招くかもしれませんが、ワンポイントな強調目的に便利です。
画像とテキストを対応ファイルとしています。
JavaScriptでleanModal()を呼び出すことで説明画面出力(lightbox)を実現します。

\item[Topに戻るボタン]~\\
ページを最上部まで戻す際、右下にボタンを配置させておき、初期段階ではボタンを非表示にしておきます。
スクロールイベントを加え、スクール量を取得してからスクロールイベントが発生する位置を調整します。
ready関数を呼び出すことでTopに戻るボタンを実現します。

\item[十字チャートでの評価]~\\
ユーザがお酒のレビューをする際、お酒の評価を十字チャートで決めることができます。
この機能を用いることで、ユーザがお酒の評価を決めることができます。
JavaScriptからレーダーチャートをcanvas要素に描画します。

\end{description}

\newpage
\section{ルーティング}
本システムの各ページへのルーティングと対応するコントローラは、表\ref{routing}の通りです。

\begin{table}[!htbp]
\caption{ルーティング一覧}
\label{routing}
\small
\begin{center}
\begin{tabular}{|l|l|l|p{4cm}|}\hline
ページ内容 & ルーティング & HTTPメソッド & 対応するコントローラ\\\hline\hline
トップページ & / & GET & \multirow{5}{*}{Indexesコントローラ} \\\cline{1-3}
検索（お酒） & /drink?検索条件 & GET & \\\cline{1-3}
検索（食材） & /food?検索条件 & GET & \\\cline{1-3}
検索（店舗） & /store?検索条件 & GET &  \\\cline{1-3}
検索（語句） & /search?検索語句 & GET & \\\hline
\multirow{2}{*}{お酒（詳細）} & \multirow{2}{*}{/:drink\_name}
& GET & \multirow{4}{*}{Drinksコントローラ} \\\cline{3-3}
 & & POST &  \\\cline{1-3}
\multirow{2}{*}{お酒（レビュー）} & \multirow{2}{*}{/:drink\_name/review}
& GET & \\\cline{3-3}
 & & POST & \\\hline
\multirow{2}{*}{店舗（詳細）} & \multirow{2}{*}{/:store\_name}
& GET & \multirow{4}{*}{Storesコントローラ} \\\cline{3-3}
 & & POST &  \\\cline{1-3}
\multirow{2}{*}{店舗（レビュー）}& \multirow{2}{*}{/:store\_name/review}
& GET &  \\\cline{3-3}
 & & POST &\\\hline
検索（観光地等） & /resort?検索条件 & GET & Resortsコントローラ \\\hline
\multirow{2}{*}{ユーザ登録} & \multirow{2}{*}{/registration\_user}
& GET & \multirow{12}{*}{Userコントローラ} \\\cline{3-3}
 & & POST & \\\cline{1-3}
 \multirow{2}{*}{ログイン（ユーザ）} & \multirow{2}{*}{/login\_user}
 & GET & \\\cline{3-3}
 & & POST & \\\cline{1-3}
マイページ（トップ） & /:user\_name
& GET & \\\cline{1-3}
\multirow{2}{*}{マイページ（お気に入り）} & /:user\_name/favorites
& GET & \\\cline{2-3}
 & /:user\_name/favorites/:favorite\_id & DELETE & \\\cline{1-3}
\multirow{2}{*}{マイページ（レビュー）} & /:user\_name/reviews
& GET & \\\cline{2-3}
 & /user\_name/reviews/:review\_id & DELETE & \\\cline{1-3}
\multirow{3}{*}{マイページ（設定）} & \multirow{3}{*}{/:user\_name/config}
& GET & \\\cline{3-3}
 & & POST & \\\cline{3-3}
 & & DELETE & \\\hline
 \multirow{2}{*}{店舗登録申請} & \multirow{2}{*}{/store/request}
 & GET & \multirow{13}{*}{Storeコントローラ} \\\cline{3-3}
  & & POST &\\\cline{1-3}
 \multirow{2}{*}{店舗登録} & \multirow{2}{*}{/store/registration}
 & GET &\\\cline{3-3}
  & & POST &\\\cline{1-3}
 \multirow{2}{*}{ログイン（店舗）} & \multirow{2}{*}{/login\_store}
 & GET & \\\cline{3-3}
  & & POST & \\\cline{1-3}
\multirow{3}{*}{店舗マイページ（編集）}& \multirow{3}{*}{/store/:store\_name}
& GET & \\\cline{3-3}
 & & POST & \\\cline{3-3}
 & & DELETE & \\\cline{1-3}
店舗マイページ（レビュー） & /store/:store\_name/review
& GET & \\\cline{1-3}
\multirow{3}{*}{店舗マイページ（設定）} & \multirow{3}{*}{/store/:store\_name/config}
& GET & \\\cline{3-3}
 & & POST & \\\cline{3-3}
 & & DELETE & \\\hline
\end{tabular}
\end{center}
\end{table}

\section{コントローラ}
本システムで作成し、使用するコントローラは表\ref{controller}の通りです。

\begin{table}[!htbp]
\caption{コントローラ一覧}
\label{controller}
\small
\begin{center}
\begin{tabular}{|l|p{5cm}|}\hline
コントローラ名 & 詳細 \\\hline\hline
\multirow{2}{*}{Indexes} & トップページ、検索に関するコントローラです。 \\\hline
Users & ユーザに関するコントローラです。 \\\hline
Stores & 店舗に関するコントローラです。 \\\hline
Drinks & お酒に関するコントローラです。 \\\hline
Resorts & 観光地に関するコントローラです。 \\\hline
\end{tabular}
\end{center}
\end{table}

\section{モデル}

本システムで作成し、使用するモデルは表\ref{model}の通りです。

\begin{table}[!htbp]
\caption{モデル一覧}
\label{model}
\small
\begin{center}
\begin{tabular}{|l|l|l|p{5cm}|}\hline
モデル名 & \multicolumn{2}{|l|}{リレーション} & 詳細 \\\hline\hline
\multirow{2}{*}{User} & Review & 1:N & \multirow{2}{*}{ユーザに関するモデルです。}\\\cline{2-3}
 & Favorite & 1:N & \\\hline
\multirow{4}{*}{Store} & Drink & N:M & \multirow{4}{*}{店舗に関するモデルです。} \\\cline{2-3}
 & Dish & N:M & \\\cline{2-3}
 & Review & 1:N & \\\cline{2-3}
 & Favorite & 1:N & \\\hline
\multirow{5}{*}{Drink} & Store & N:M & \multirow{5}{*}{お酒に関するモデルです。} \\\cline{2-3}
 & Brewer & N:1 & \\\cline{2-3}
 & Alcoholic & N:1 & \\\cline{2-3}
 & Review & 1:N & \\\cline{2-3}
 & Favorite & 1:N & \\\hline
\multirow{2}{*}{Dish} & Store & N:M & \multirow{2}{*}{料理に関するモデルです。} \\\cline{2-3}
 & Ingredient & N:M & \\\hline
Ingredient & Dish & N:M & 食材に関するモデルです。 \\\hline
Brewer & Drink & 1:N & 酒蔵に関するモデルです。 \\\hline
Alcoholic & Drink & 1:N & 酒類に関するモデルです。 \\\hline
\multirow{3}{*}{Review} & User & N:1 & \multirow{3}{*}{レビューに関するモデルです。} \\\cline{2-3}
 & Store & N:1 & \\\cline{2-3}
 & Drink & N:1 & \\\hline
Resort & & & 観光地に関するモデルです。 \\\hline
\end{tabular}
\end{center}
\end{table}

\clearpage

\section{ライブラリ}
本システムで使用するライブラリは、表\ref{library}の通りです。

\begin{table}[!htbp]
\caption{ライブラリ一覧}
\label{library}
\small
\begin{center}
\begin{tabular}{|l|p{6cm}|}\hline
ライブラリ名 & 詳細 \\\hline\hline
\multirow{2}{*}{Devise} & ユーザ登録に関する機能を提供してくれるライブラリです。\\\hline
\multirow{3}{*}{RMagick} & CarrierWaveと組み合わせることで、画像アップロード時にサムネイルを作成する機能などを提供してくれるライブラリです。\\\hline
\multirow{2}{*}{CarrierWave} & ファイルアップロードに関する機能を提供してくれるライブラリです。\\\hline
\multirow{2}{*}{Better\_Errors} & デバッグしやすいエラー画面を提供してくれるライブラリです。\\\hline
\multirow{2}{*}{factory\_girl\_rails} & 簡易なデータ作成機能を提供してくれるライブラリです。 \\\hline
\end{tabular}
\end{center}
\end{table}

\clearpage

\section{モデル定義}
本システムで作成し、使用するモデルの定義は次の通りです。

\subsection{User}
Userモデルの定義は、表\ref{user}の通りです。

\begin{table}[!htbp]
\caption{Userモデルの定義}
\label{user}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
email & string & $\circ$ \\\hline
password & string & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Store}
Storeモデルの定義は、表\ref{store}の通りです。

\begin{table}[!htbp]
\caption{Storeモデルの定義}
\label{store}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
email & string & $\circ$ \\\hline
password & string & $\circ$ \\\hline
address & text & $\circ$ \\\hline
phone\_number & string & $\circ$ \\\hline
budget & integer & $\circ$ \\\hline
detail & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Drink}
Drinkモデルの定義は、表\ref{drink}の通りです。

\begin{table}[!htbp]
\caption{Drinkモデルの定義}
\label{drink}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
alcohol & integer & $\circ$ \\\hline
detail & text & $\circ$ \\\hline
alcoholic\_id & integer & $\circ$ \\\hline
brewer\_id & integer & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Dish}
Dishモデルの定義は、表\ref{dish}の通りです。

\begin{table}[!htbp]
\caption{Dishモデルの定義}
\label{dish}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
local\_dishes & boolean & $\circ$ \\\hline
detail & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Ingredient}
Ingredientモデルの定義は、表\ref{ingredient}の通りです。

\begin{table}[!htbp]
\caption{Ingredientモデルの定義}
\label{ingredient}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Brewer}
Brewerモデルの定義は、表\ref{brewer}の通りです。

\begin{table}[!htbp]
\caption{Brewerモデルの定義}
\label{brewer}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Alcoholic}
Alcoholicモデルの定義は、表\ref{alcoholic}の通りです。

\begin{table}[!htbp]
\caption{Alcoholicモデルの定義}
\label{alcoholic}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
item1 & text & $\circ$ \\\hline
item2 & text & $\circ$ \\\hline
item3 & text & $\circ$ \\\hline
item4 & text & $\circ$ \\\hline
item5 & text & $\circ$ \\\hline
item6 & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Review}
Reviewモデルの定義は、表\ref{review}の通りです。

\begin{table}[!htbp]
\caption{Reviewモデルの定義}
\label{review}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
\end{tabular}
\end{center}
\end{table}

\subsection{Resort}
Resortモデルの定義は、表\ref{resort}の通りです。

\begin{table}[!htbp]
\caption{Resortモデルの定義}
\label{resort}
\small
\begin{center}
\begin{tabular}{|l|l|c|}\hline
カラム名 & 型 & null \\\hline\hline
name & text & $\circ$ \\\hline
address & text & $\circ$ \\\hline
detail & text & $\circ$ \\\hline
\end{tabular}
\end{center}
\end{table}

\end{document}
